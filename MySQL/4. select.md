# 4. select

## 查询表的全部内容

```sql
select * from humans;
```

![图 0](images/2fb1d4dd6bf568d7da00790aa150a0784adeb9da4648baa481131b9fa648ac4d.png)  

## 查询多列内容

```sql
select id, name from humans;
```

![图 1](images/c96e7b4cbd3746acacbf5bb727a11a47b95ca957f890d745e5289f1e9fb1f912.png)  

## distinct：对查询的内容去重

比如查询 sex 列时，会返回 6 行数据，但是去除重复之后，其实只有两条有效信息:

```sql
select sex from humans;
```

![图 2](images/06818182f6a9ed219640544f5191af02fa0ec9a37a52a5cdcf11b94eb66da287.png)  

distinct 去除重复行：

```sql
select distinct sex from humans;
```

![图 3](images/c2013cea4c45931221a7b2ecc50efaa4f1187e0283eb40dec5cc701d9a5884fe.png)  

注意，distinct 是先查询所有的行，然后丢弃掉已经存在的相同的行：

```sql
select a_col, b_col from Test;
```

![alt text](images/image.png)

```sql
select distinct a_col, b_col from Test;
```

![图 4](images/1a67c93ad1e22028200e3087f6807ac05fcff65926c80cdc9d8acc39fbd85d9c.png)  

## limit 获取前 n 行数据

假设我需要获取 humans 表的前 3 行数据：

```sql
select * from humans limit 3;
```

![图 5](images/ffafe36ff6d2c2293b7afc89d4125f0b65fd860cd0d6dafeab54f84b669bd7ba.png)  

从第 2 行开始的前 3 行数据

**注意，行号是从 0 开始编号的！**

```sql
select * from humans limit 2, 3;
```

![图 6](images/ef2a455b64bab9758b518e4ab0f5d17e07603076c5f53b218ff373e719a1ed7d.png)  

行号是这样列的：

第 0 行，第 1 行，第 2 行，第 3 行，第 4 行，第 5 行 ··· ···

## 使用列的全称查询

```sql
select id, name from humans;
```

使用列的全称后：

```sql
select humans.id, humans.name from humans;
```

![图 7](images/b262c417a2caef6235660b1da7275b782fe504d67d5d65a07adeb45d8c8ce772.png)  

## 给列取别名

```sql
select humans.id 编号, humans.name 名称 from humans
```

或者:

```sql
select humans.id as 编号, humans.name as 名称 from humans
```

![图 8](images/e56ea14f92fa6f9c6bfde02382274e326111fb69afa7a88ef87d9085e98215c6.png)  

## order by: 对查询到的列排序

假设有如下表内容：

![图 9](images/f15a76a0599fc3305b9baa6f717342b5e4b6e907aebec3623d89a1d9245ca0fd.png)  

### 根据单列的内容排序

按照 id 排序查询数学、英语、语文成绩内容：

```sql
select id, Math, English, Chinese from Student
order by id;
```

![图 10](images/539675010995d8ce5ccc7107157b88a20cab9f729244f158584c0f14bc7e593e.png)  

### 根据多列的内容排序

按照英语成绩排序，如果成绩相同，就按照学号排序：

```sql
select id, name, English from Student
order by English, id;
```

![图 11](images/282447c78b2bd7f6a4b007ddce06b517d532efef16d22be3ab220a5de3614b5f.png)  

### 对某列降序要求

按照英语成绩从高到低排序，如果成绩相同，就按照学号递增顺序排序：

```sql
select id, name, English from Student
order by English desc, id;
```

![图 12](images/f73e5967f5e8d3b92745682686bd6894fe70580dee40373b08f3855788092e71.png)  

## where: 过滤数据

### where 比较运算符

```sql
=                   等于
<>                  不等于
!=                  不等于
<                   小于
<=                  小于等于
>                   大于
>=                  大于等于
between a and b     介于 [a, b] 之间
```

---

查找数学成绩在 90 到 100 的学生姓名：

```sql
select name from Student
where Math between 90 and 100;
```

![图 13](images/4c060f792a0c686694475574ba41f4f4c34a42997991f3f59ebc3896f8786cd0.png)  

---

查找数学成绩大于 80 分的学生姓名：

```sql
select name, Math from Student
where Math > 80;
```

![图 14](images/1e3aa723af767ec492a97e2e67e31c4c987764d47ffa4a1fc2a92cec92e7cbf3.png)  

---

查询数学成绩最高的学生的整体成绩：

```sql
select name, Math, English, Chinese from Student
where Math = (select max(Math) from Student );
```

![图 15](images/03b45dc5b9206c604a6a2b95b4af9e63caeee381c8e2f3a8b9968467962bf463.png)  

---

查找除数学成绩最高之外的其他学生成绩：

```sql
select name, Math, English, Chinese from Student
where Math <> ( select max(Math) from Student);
```

![图 16](images/02ebc3297d1aae7b9c43cf56dcba7283ba403e48449b4c0dffe91e4d6aa1619c.png)  

---


### null 值检查

假设有如下表：

![图 17](images/ff0b96651c3ab38d92f357128dbec57dca505e2f630414f4396e66f7ba744472.png)  


获取年龄为 null 的角色：

```sql
select name from Wifes
where age is null;
```

![图 18](images/7957182af8730f1bdb3edde52347480bff1ced476c1e23114eb24068c37f6a2a.png)  

### where 逻辑运算符

```sql
and                 逻辑与
or                  逻辑或
not                 逻辑非
in                  存在于
```

---

查询数学、英语、语文成绩同时大于或等于 80 的学生

```sql
select name, Math, English, Chinese from Student
where Math >= 80 and English >= 80 and Chinese >= 80;
```

![图 19](images/3b718c5f3a15f36362180bb4cb38965ad5420895a6e20c8f91f7835264fbba65.png)  

---

查询『丛雨』或者『优菈』的年龄：

```sql
select name, age from Wifes
where name in ('丛雨', '优菈');
```

![图 21](images/85f5429ab53dc24a3c0f89ea4668854c796130558a42c99027bb9d0708f0a3fb.png)  


---

### where 子句中不能列别名

查询数学、英语、语文成绩同时大于或等于 80 的学生

<details error><summary>错误代码</summary>

```sql
select name, Math m, English e, Chinese c from Student
where m >= 80 and e >= 80 and c >= 80;
```

</details>

<details accept><summary>正确代码</summary>

```sql
select name, m Math, e English, c Chinese
from ( select name, Math m, English e, Chinese c from Student ) temp_table
where m >= 80 and e >= 80 and c >= 80;
```

![图 20](images/afd8346f37d9a1d62db47c585197782970a4df3f8954c4593bdb50455f2cb12c.png)  


</details>

## regexp: 正则表达式

查询 humans 表中 id 以 1 - 5 结尾的行：

```sql
select * from humans
where id REGEXP '.*?[1-5]';
```

![图 22](images/288fadc86dd3b035384e75411d05d24d29a06af5cfc487d9bffdafefd1cfa4cc.png)  

## concat: 对查询到的列拼接其他字符串

假设有如下表：

![图 25](images/836f194a6141aaef82910e29d2f6b6b8f5a55ba2de84d114ac0c734ae3ad78fe.png)  

将姓与名结合：

```sql
select concat('姓名：', surname, name) as 姓名 from people;
```

![图 26](images/2a0ebed2512f6da0ed2308a9de3b28c02fa128e6217228b16ea8c01b464ddeeb.png)  


## 相关表数据

<details><summary>插入数据</summary>

```sql
create table humans (
    id varchar(32),
    name varchar(20),
    sex int
);

insert into humans value
    ('000000001', 'aa', 0),
    ('000000002', 'bb', 1),
    ('000000003', 'cc', 0),
    ('000000004', 'dd', 0),
    ('000000005', 'ee', 1),
    ('000000006', 'ff', 0);
```

```sql
create table Test (
                        a_col varchar(20),
                        b_col varchar(20)
);

insert into Test value
    ('a6', 'b6'),
    ('a2', 'b2'),
    ('a1', 'b1'),
    ('a6', 'b6'),
    ('a2', 'b2'),
    ('a1', 'b1');
```

```sql
create table Student (
    id varchar(20),
    name varchar(20),
    Math int,
    English int,
    Chinese int
);

insert into Student values
                        ('6', 'stu6', 76, 46, 79),
                        ('1', 'stu1', 89, 90, 90),
                        ('7', 'stu7', 43, 48, 84),
                        ('3', 'stu3', 56, 78, 86),
                        ('8', 'stu8', 91, 78, 86),
                        ('5', 'stu5', 87, 60, 81),
                        ('4', 'stu4', 68, 15, 73),
                        ('2', 'stu2', 99, 56, 90);
```

```sql
create table Wifes (
    name varchar(20),
    age int
);

insert into Wifes values
                      ('北白川玉子', 16),
                      ('优菈', 20),
                      ('御坂美琴', 14),
                      ('洛琪希', 37);

insert into Wifes (name) value ('丛雨');
```

```sql
create table people (
                        surname varchar(20),
                        name varchar(20)
);

insert into people values
                       ('涂山', '雅雅'),
                       ('涂山', '容容'),
                       ('涂山', '苏苏'),
                       ('东方', '月初'),
                       ('白', '月初');
```

</details>